!function(){var e={184:function(e,t){var r;!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var s=typeof r;if("string"===s||"number"===s)e.push(r);else if(Array.isArray(r)){if(r.length){var c=o.apply(null,r);c&&e.push(c)}}else if("object"===s)if(r.toString===Object.prototype.toString)for(var a in r)n.call(r,a)&&r[a]&&e.push(a);else e.push(r.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}()}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=window.wp.element,t=window.React,n=window.wp.blocks,o=window.wp.i18n;const s=/^https?:\/\/wordpress\.com\/((?<lang>[a-z]{2})\/)?support\/(?<slug>[^# ]+)/i,c=/^https?:\/\/(?<domain>[-a-zA-Z0-9@:%._+~#=]*)\/((?<lang>[a-z]{2})\/)?(?<prefix>[-a-zA-Z0-9@:%._+~#=\/]*)topic\/(?<slug>\S+)$/i,a=400;var l;function u(e){return s.test(e)?l.SUPPORT_PAGE:c.test(e)?l.FORUM_TOPIC:null}async function i(e,t,r){try{const n=r?`https://public-api.wordpress.com/rest/v1.1/users/${e}`:`https://${t}/wp-json/wp/v2/users/${e}`,o=await fetch(n);if(!o.ok)return null;const s=await o.json();return s.display_name||s.name}catch(e){return}}function p(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}!function(e){e.SUPPORT_PAGE="support_page",e.FORUM_TOPIC="forum_topic"}(l||(l={}));var m=window.wp.blockEditor,d=window.wp.components,f=window.wp.compose,h=window.wp.primitives,v=(0,e.createElement)(h.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(h.Path,{d:"M20.1 5.1L16.9 2 6.2 12.7l-1.3 4.4 4.5-1.3L20.1 5.1zM4 20.8h8v-1.5H4v1.5z"})),b=r(184),w=r.n(b);function _(e,t){return e===t}function E(e){return"function"==typeof e?function(){return e}:e}const g=r=>{const[n,s]=(0,e.useState)([]),[c,a]=(0,e.useState)(!1),[l]=(u=r.search,f=_,p=(0,t.useState)(E(u)),m=p[1],h=[p[0],(0,t.useCallback)((function(e){return m(E(e))}),[])],v=h[0],b=h[1],w=function(e,r,n){var o=this,s=(0,t.useRef)(null),c=(0,t.useRef)(0),a=(0,t.useRef)(null),l=(0,t.useRef)([]),u=(0,t.useRef)(),i=(0,t.useRef)(),p=(0,t.useRef)(e),m=(0,t.useRef)(!0);(0,t.useEffect)((function(){p.current=e}),[e]);var d=!r&&0!==r&&"undefined"!=typeof window;if("function"!=typeof e)throw new TypeError("Expected a function");r=+r||0;var f=!!(n=n||{}).leading,h=!("trailing"in n)||!!n.trailing,v="maxWait"in n,b=v?Math.max(+n.maxWait||0,r):null;(0,t.useEffect)((function(){return m.current=!0,function(){m.current=!1}}),[]);var w=(0,t.useMemo)((function(){var e=function(e){var t=l.current,r=u.current;return l.current=u.current=null,c.current=e,i.current=p.current.apply(r,t)},t=function(e,t){d&&cancelAnimationFrame(a.current),a.current=d?requestAnimationFrame(e):setTimeout(e,t)},n=function(e){if(!m.current)return!1;var t=e-s.current;return!s.current||t>=r||t<0||v&&e-c.current>=b},w=function(t){return a.current=null,h&&l.current?e(t):(l.current=u.current=null,i.current)},_=function e(){var o=Date.now();if(n(o))return w(o);if(m.current){var a=r-(o-s.current),l=v?Math.min(a,b-(o-c.current)):a;t(e,l)}},E=function(){var p=Date.now(),d=n(p);if(l.current=[].slice.call(arguments),u.current=o,s.current=p,d){if(!a.current&&m.current)return c.current=s.current,t(_,r),f?e(s.current):i.current;if(v)return t(_,r),e(s.current)}return a.current||t(_,r),i.current};return E.cancel=function(){a.current&&(d?cancelAnimationFrame(a.current):clearTimeout(a.current)),c.current=0,l.current=s.current=u.current=a.current=null},E.isPending=function(){return!!a.current},E.flush=function(){return a.current?w(Date.now()):i.current},E}),[f,v,r,b,h,d]);return w}((0,t.useCallback)((function(e){return b(e)}),[b]),1e3,i),g=(0,t.useRef)(u),f(g.current,u)||(w(u),g.current=u),[v,w]);var u,i,p,m,f,h,v,b,w,g;return(0,e.useEffect)((()=>{s([]),a(!0)}),[r.search]),(0,e.useEffect)((()=>{(async function(e){const t=`https://public-api.wordpress.com/wp/v2/sites/en.support.wordpress.com/pages?search=${encodeURIComponent(e)}`,r=await fetch(t);if(!r.ok)return[];const n=(await r.json()).map((e=>({title:e.title.rendered.replace("&nbsp;"," "),url:e.link.replace("en.support.wordpress.com","wordpress.com/support")})));return n.length>5?n.slice(0,5):n})(l).then((e=>{s(e),a(!1)}))}),[l]),c||0!==n.length?(0,e.createElement)("div",{className:"be-support-content-search-results"},(0,e.createElement)("div",{className:"be-support-content-search-results__list"},c&&(0,e.createElement)("div",{className:"be-support-content-search-results__loading"},(0,e.createElement)(d.Spinner,null),(0,e.createElement)("span",null,(0,o.__)("Loading content suggestions...","blocks-everywhere"))),n.map((t=>(0,e.createElement)("div",{className:"be-support-content-search-results__item",onClick:()=>r.setUrl(t.url)},(0,e.createElement)("div",{className:"be-support-content-search-results__title"},t.title),(0,e.createElement)("a",{className:"be-support-content-search-results__link",href:t.url,target:"_blank"},t.url)))))):null},k=t=>{var r,n,s;const[c,a]=(0,e.useState)(null),l=(null===(r=t.url)||void 0===r?void 0:r.startsWith("http://"))||(null===(n=t.url)||void 0===n?void 0:n.startsWith("https://")),u=!l&&(null===(s=t.url)||void 0===s?void 0:s.length)>3;return(0,e.useEffect)((()=>{a(u?t.url:null)}),[t.url,u]),(0,e.createElement)("div",{className:w()("be-support-content-placeholder",t.className)},(0,e.createElement)(d.Placeholder,{icon:t.icon,label:t.label,instructions:t.instructions,notices:t.notices},(0,e.createElement)("form",{onSubmit:e=>{e.preventDefault(),t.onSubmit()}},(0,e.createElement)("input",{type:"url",value:t.url,className:"components-placeholder__input",placeholder:t.placeholder,onChange:e=>t.updateUrl(e.target.value)}),(0,e.createElement)(d.Button,{isPrimary:!0,type:"submit",disabled:!l,"aria-disabled":!l},(0,o._x)("Embed","button label","blocks-everywhere"))),u&&(0,e.createElement)("div",{className:"be-support-content-placeholder__search-slot"},(0,e.createElement)(g,{search:c,setUrl:e=>{t.updateUrl(e),a(e)}}))))},y=()=>{const t=wpBlocksEverywhere.pluginsUrl+"/build/images/wordpress.e7ce7231.png?m=1";return(0,e.createElement)("div",{className:w()("be-support-content-wordpress-icon")},(0,e.createElement)("img",{alt:"WP",src:t}))},R=t=>t.loaded?(0,e.createElement)(e.Fragment,null,t.children):(0,e.createElement)("span",{className:w()("be-support-content-inline-skeleton",{"is-hidden":t.hidden,"is-large":t.large})}),N=t=>{var r;const n=!!t.attributes.content,s=(0,o.sprintf)(
/* translators: Number of people marked this page useful, eg: "25332 people have found this useful" */
(0,o.__)("%1$d people have found this useful!","blocks-everywhere"),null!==(r=t.attributes.minutesToRead)&&void 0!==r?r:0),c=(0,o.sprintf)("in <a>%s</a>",t.attributes.source),a=t.attributes.minutesToRead||t.attributes.author||t.attributes.created;return(0,e.createElement)("div",{className:"be-support-content"},!!t.attributes.created&&(0,e.createElement)("div",{className:"be-support-content__created"},t.attributes.created),t.clickable&&(0,e.createElement)("a",{className:"be-support-content__opener",href:t.attributes.url}),(0,e.createElement)("div",{className:"be-support-content__header"},(0,e.createElement)(y,null),(0,e.createElement)("div",null,(0,e.createElement)("div",{className:"be-support-content__title"},(0,e.createElement)(R,{loaded:n},t.attributes.title)),(0,e.createElement)("div",{className:"be-support-content__source"},(0,e.createElement)(R,{hidden:!0,loaded:n},(0,e.createInterpolateElement)(c,{a:(0,e.createElement)("a",{className:"be-support-content__link",href:t.attributes.sourceURL})}))),(!n||a)&&(0,e.createElement)("div",{className:"be-support-content__details"},(0,e.createElement)(R,{loaded:n},(()=>{if(!n)return null;const r=t.attributes.minutesToRead?(0,o.sprintf)(
/* translators: Minutes it takes to read embedded support page, eg: "5 min to read" */
(0,o.__)("%1$d min read","blocks-everywhere"),t.attributes.minutesToRead):"",s=(0,e.createElement)("span",{className:"be-support-content__relative-created"},t.attributes.created&&t.showRelativeDate?(c=t.attributes.created,(0,window.moment)(c).fromNow()):"");var c;if(t.attributes.author){const n=(0,o.sprintf)(
/* translators: Person who created forum topic, eg: "Started by davidgonzalezwp" */
(0,o.__)("Started by %s","blocks-everywhere"),t.attributes.author);return(0,e.createElement)(e.Fragment,null,n," ",s," ",r)}if(t.attributes.created){
/* translators: Date when forum topic was created, eg: "Started 5 days ago" */
const t=(0,o.__)("Started","blocks-everywhere");return(0,e.createElement)(e.Fragment,null,t," ",s," ",r)}return r})())))),(0,e.createElement)("div",{className:"be-support-content__content"},(0,e.createElement)(R,{large:!0,loaded:n},t.attributes.content)),(!n||t.attributes.likes)&&(0,e.createElement)("div",{className:"be-support-content__reactions"},(0,e.createElement)(R,{loaded:n},s)))},C=t=>(0,e.createElement)("div",{className:w()("be-support-content-block-icon",{"is-margin-right":t.marginRight})},(0,e.createElement)(d.SVG,{width:"18",height:"18",viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},(0,e.createElement)(d.Path,{d:"M2 0.75H16C16.6904 0.75 17.25 1.30964 17.25 2V16C17.25 16.6904 16.6904 17.25 16 17.25H2C1.30964 17.25 0.75 16.6904 0.75 16V2C0.75 1.30964 1.30964 0.75 2 0.75Z",stroke:"#1E1E1E",strokeWidth:"1.5"}),(0,e.createElement)(d.Path,{d:"M6 1L2 5.5L2 1L6 1Z",fill:"#1E1E1E",stroke:"#1E1E1E"}),(0,e.createElement)(d.Path,{d:"M11 12.2857L14 9L11 6",stroke:"#1E1E1E",strokeWidth:"1.5"}),(0,e.createElement)(d.Path,{d:"M7 12.2857L4 9L7 6",stroke:"#1E1E1E",strokeWidth:"1.5"})));var P=window.wp.data;const S=t=>{let{url:r,confirm:n,cancel:s}=t;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("a",{href:r,target:"_blank"},r),(0,e.createElement)("span",{className:"be-support-content-confirm-anchor"},(0,e.createElement)(d.Popover,{onFocusOutside:s,variant:"unstyled",offset:16,placement:"right-start"},(0,e.createElement)("div",{className:"be-support-content-confirm-content"},(0,e.createElement)(d.__experimentalElevation,{value:3}),(0,e.createElement)(d.NavigableMenu,{role:"menu"},(0,e.createElement)(d.MenuItem,{variant:"tertiary",className:"be-support-content-confirm-content__item",onClick:e=>{e.preventDefault(),n()}},(0,o.__)("Create embed","blocks-everywhere")),(0,e.createElement)(d.MenuItem,{variant:"tertiary",isDestructive:!0,className:"be-support-content-confirm-content__item",onClick:e=>{e.preventDefault(),s()}},(0,o.__)("Dismiss","blocks-everywhere")))))))},U=(0,f.compose)(d.withNotices)((t=>{const{attributes:r,className:f,setAttributes:h,noticeOperations:b,noticeUI:w}=t,{replaceBlock:_}=(0,P.useDispatch)("core/editor"),E=(0,o.__)("Embed a Support doc or a forum topic.","blocks-everywhere"),g=(0,o.__)("It does not look like a Support doc or a forum topic URL.","blocks-everywhere"),y=(0,o.__)("Search or insert URL","blocks-everywhere"),[R,U]=(0,e.useState)(t.attributes.isConfirmed),[x,L]=(0,e.useState)(!1),[T,M]=(0,e.useState)(r.url),[O,$]=(0,e.useState)(!1);(0,e.useEffect)((()=>{$(!0)}),[]);const F=async()=>{if(!u(T))return b.removeAllNotices(),void b.createErrorNotice(g);try{b.removeAllNotices(),L(!1),h({url:T,content:null});const e=await async function(e){const t=await u(e);if(t==l.SUPPORT_PAGE)return async function(e){var t;const{blog:r,slug:n}=function(e){var t,r,n,o;const c=e.match(s),a=null!==(t=null==c||null===(r=c.groups)||void 0===r?void 0:r.lang)&&void 0!==t?t:"en";let l=null!==(n=null==c||null===(o=c.groups)||void 0===o?void 0:o.slug)&&void 0!==n?n:"";return l.endsWith("/")&&(l=l.slice(0,-1)),{blog:`${a}.support.wordpress.com`,slug:l}}(e),c=`https://public-api.wordpress.com/rest/v1.1/sites/${r}/posts/slug:${encodeURIComponent(n)}`,l=await fetch(c);if(!l.ok)throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"));const u=await l.json(),i=null!==(t=u.parent)&&void 0!==t&&t.title?`${u.parent.title} » ${u.title}`:u.title;let m=p(u.content);const d=m.trim().split(/\s+/),f=d.length?Math.ceil(d.length/250):null;return m.length>a&&(m=m.substring(0,a)),{url:e,isConfirmed:!0,content:m,title:i,source:"WordPress.com Support",sourceURL:"https://wordpress.com/support/",minutesToRead:f}}(e);if(t==l.FORUM_TOPIC)return async function(e){const{blog:t,slug:r}=function(e){var t,r,n,o;const s=e.match(c),a=null!==(t=null==s||null===(r=s.groups)||void 0===r?void 0:r.lang)&&void 0!==t?t:"en";let l=null!==(n=null==s||null===(o=s.groups)||void 0===o?void 0:o.slug)&&void 0!==n?n:"";return l.indexOf("/")>=0&&(l=l.slice(0,l.indexOf("/"))),{blog:"wordpress.com"==s.groups.domain?`${a}.forums.wordpress.com`:s.groups.domain,slug:l}}(e),n=t.endsWith("wordpress.com"),s=n?`https://public-api.wordpress.com/wp/v2/sites/${t}/topic?slug=${encodeURIComponent(r)}`:`https://${t}/wp-json/wp/v2/topic?slug=${encodeURIComponent(r)}`,l=await fetch(s);if(!l.ok)throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"));const u=(await l.json())[0],m=p(u.title.rendered);let d=p(u.content.rendered);return d.length>a&&(d=d.substring(0,a)),{url:e,isConfirmed:!0,content:d,title:m,author:u.author?await i(u.author,t,n):void 0,source:n?"WordPress.com Forums":`${t} Forums`,sourceURL:`https://${t}`,status:u.status,created:u.date}}(e);throw new Error((0,o.__)("Failed to load the page. Check URL","blocks-everywhere"))}(T);h(e)}catch(e){L(!0),b.createErrorNotice(e.message||e||(0,o.__)("Unable to fetch the page, check the URL","blocks-everywhere"))}},A=(0,m.useBlockProps)();return R?(0,e.createElement)("div",A,(0,e.createElement)(m.BlockControls,null,(0,e.createElement)(d.ToolbarGroup,null,!x&&(0,e.createElement)(d.ToolbarButton,{icon:v,label:(0,o.__)("Edit URL","blocks-everywhere"),isActive:x,onClick:()=>{L(!x)}}))),x||!r.url?(0,e.createElement)(k,{className:f,icon:(0,e.createElement)(C,{marginRight:!0}),instructions:E,label:"Content Embed",url:T,notices:w,placeholder:y,onSubmit:F,updateUrl:M}):(0,e.createElement)(N,{attributes:r,showRelativeDate:!0})):(0,e.createElement)("div",A,O&&(0,e.createElement)(S,{url:T,confirm:async()=>{U(!0),await F()},cancel:()=>{const t=(0,e.createElement)("a",{href:T},T),r=(0,n.createBlock)("core/paragraph",{content:(0,e.renderToString)(t)});_(A["data-block"],r)}}))}));(0,n.registerBlockType)("blocks-everywhere/support-content",{title:(0,o.__)("Content Embed","blocks-everywhere"),icon:(0,e.createElement)(C,null),category:"embed",description:(0,o.__)("Embed a page from the WordPress Guide or a forum topic","blocks-everywhere"),keywords:[(0,o.__)("guide"),(0,o.__)("support"),(0,o.__)("how to"),(0,o.__)("howto"),(0,o.__)("forum"),(0,o.__)("topic")],attributes:{url:{type:"string"},isConfirmed:{type:"boolean",default:!0},title:{type:"string",source:"text",selector:".be-support-content__title"},content:{type:"string",source:"text",selector:".be-support-content__content"},source:{type:"string",source:"text",selector:".be-support-content__link"},sourceURL:{type:"string",source:"attribute",selector:".be-support-content__link",attribute:"href"},minutesToRead:{type:"number"},likes:{type:"number"},status:{type:"string"},author:{type:"string"},created:{type:"string",source:"text",selector:".be-support-content__created"}},supports:{align:!0,anchor:!0},edit:U,save:t=>{const r=m.useBlockProps.save(),{attributes:n}=t;return(0,e.createElement)("div",r,(0,e.createElement)(N,{attributes:n,clickable:!0}))},transforms:{from:[{type:"raw",isMatch:e=>{var t,r;return"P"===e.nodeName&&!!u(null!==(t=null===(r=e.textContent)||void 0===r?void 0:r.trim())&&void 0!==t?t:"")},transform:e=>{var t,r;const o=null!==(t=null===(r=e.textContent)||void 0===r?void 0:r.trim())&&void 0!==t?t:"";return(0,n.createBlock)("blocks-everywhere/support-content",{url:o,isConfirmed:!1})}}],to:[{type:"block",blocks:["core/paragraph"],transform:t=>{let{url:r}=t;const o=(0,e.createElement)("a",{href:r},r);return(0,n.createBlock)("core/paragraph",{content:(0,e.renderToString)(o)})}}]}})}()}();